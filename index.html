<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Daily Operations Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ---------- VARIABLES & RESET ---------- */
:root {
  --primary: #0056b3; --bg-body: #f4f6f9; --bg-card: #ffffff;
  --text-main: #212529; --text-muted: #6c757d; --border: #dee2e6;
  --success: #28a745; --warning: #ffc107; --danger: #dc3545; --info: #17a2b8;
  --shadow: 0 4px 6px rgba(0,0,0,0.05); --radius: 8px;
  --header-bg: #1e293b; --header-text: #ffffff;
}
* { box-sizing: border-box; }
body { font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; padding-bottom: 60px; }

/* ---------- HEADER ---------- */
.dashboard-header {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  padding: 12px 24px; display: flex; justify-content: space-between; align-items: center;
  position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  color: var(--header-text);
}
.brand-container { display: flex; align-items: center; gap: 15px; }
.brand-logo { height: 48px; width: auto; border-radius: 6px; background: #fff; padding: 2px; }
.brand-info { display: flex; flex-direction: column; }
.brand-name { font-size: 18px; font-weight: 700; background: linear-gradient(90deg, #60a5fa, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; }
.brand-tagline { font-size: 11px; opacity: 0.8; color: #cbd5e1; }
.page-title-badge { background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 500; border: 1px solid rgba(255,255,255,0.1); margin-left: 15px; display: none; }
@media (min-width: 600px) { .page-title-badge { display: inline-block; } }
.header-right { display: flex; align-items: center; gap: 15px; }
.date-main { font-weight: 600; font-size: 14px; text-align: right; }
#dayStatus { font-size: 12px; font-weight: 600; margin-top: 2px; }
.btn-header { border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; padding: 8px 14px; font-size: 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; }
.btn-header:hover { background: rgba(255,255,255,0.15); }

/* ---------- LAYOUT COMPONENTS ---------- */
#main-wrapper { max-width: 1400px; margin: 20px auto; padding: 0 20px; }
.progress-widget { background: var(--bg-card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.progress-header { display: flex; justify-content: space-between; font-size: 14px; font-weight: 600; }
.progress-track { background: #e9ecef; border-radius: 10px; height: 10px; overflow: hidden; }
.progress-fill { background: linear-gradient(90deg, var(--primary), var(--info)); height: 100%; width: 0%; transition: width 0.5s ease-in-out; }

.partial-action-bar { display: flex; align-items: center; background: #fff; padding: 15px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: var(--shadow); }
.btn-snapshot { background: var(--info); color: white; border: none; padding: 10px 18px; border-radius: 4px; cursor: pointer; font-weight: 600; transition: 0.2s; }
.btn-snapshot:disabled { background: #6c757d; cursor: not-allowed; opacity: 0.7; }
#partialStatus { margin-left: 15px; font-size: 13px; font-weight: 600; }

#container { margin-bottom: 40px; }
.section { margin-bottom: 40px; }
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 2px solid var(--border); padding-bottom: 10px; }
.section-header h2 { font-size: 16px; text-transform: uppercase; color: var(--text-muted); margin: 0; }
.section-stats { font-size: 12px; font-weight: 600; background: #e2e6ea; padding: 4px 8px; border-radius: 4px; }

/* ---------- CARDS ---------- */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
.process-card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); overflow: hidden; transition: transform 0.2s; display: flex; flex-direction: column; }
.process-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
.process-card.done { border-top: 4px solid var(--success); }
.process-card.pending { border-top: 4px solid var(--warning); }
.process-card.issue { border-top: 4px solid var(--danger); }
.card-header { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: flex-start; }
.card-title { font-size: 15px; font-weight: 600; }
.card-time { font-size: 11px; color: var(--text-muted); background: #f8f9fa; padding: 3px 6px; border-radius: 4px; border: 1px solid #e9ecef; }
.card-body { padding: 15px; flex-grow: 1; font-size: 13px; color: #495057; }
.check-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 8px; cursor: pointer; padding: 4px; border-radius: 4px; }
.check-item input[type="checkbox"] { margin-top: 3px; accent-color: var(--success); width: 16px; height: 16px; }
.check-progress-text { font-size: 11px; color: var(--primary); font-weight: 700; margin-bottom: 10px; display: inline-block; background: #eef4fc; padding: 3px 8px; border-radius: 12px; }

/* ---------- FOOTER/FORM ---------- */
.card-footer { padding: 15px; background: #fdfdfd; border-top: 1px solid #f0f0f0; }
.form-group { margin-bottom: 10px; }
.form-control { width: 100%; padding: 8px; font-size: 13px; border: 1px solid var(--border); border-radius: 4px; }
.form-control:disabled { background: #e9ecef; opacity: 0.7; }
.status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-left: auto; }
.badge-done { background: #d4edda; color: #155724; }
.badge-pending { background: #fff3cd; color: #856404; }
.badge-issue { background: #f8d7da; color: #721c24; }
.btn { border: none; padding: 8px 16px; font-size: 13px; font-weight: 600; border-radius: 4px; cursor: pointer; }
.btn-success { background: var(--success); color: white; }
.btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
.btn-primary:disabled { background: #6c757d; cursor: not-allowed; opacity: 0.7; }

/* ---------- AD-HOC SECTION ---------- */
.ad-hoc-box { background: var(--bg-card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px dashed var(--primary); }
.final-action-area { text-align: center; padding: 30px; }
.final-btn { padding: 12px 30px; font-size: 16px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,64,133,0.3); border:none; color:white; background: var(--primary); cursor:pointer; transition: 0.2s;}
.final-btn.inactive { opacity: 0.5; background-color: #6c757d; }

@media (max-width: 768px) { .dashboard-header { flex-direction: column; align-items: flex-start; gap: 15px; } .header-right { width: 100%; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; } }
</style>
</head>
<body>

<header class="dashboard-header">
  <div class="brand-container">
    <img src="Logo.png" alt="Logo" class="brand-logo" onerror="this.style.display='none'">
    <div class="brand-info">
      <span class="brand-name">SaXhamAI</span>
      <span class="brand-tagline">Created by Nitin Pawar</span>
    </div>
    <span class="page-title-badge">üìã Operations <span style="font-size:10px; margin-left:5px; opacity:0.8; border-left:1px solid rgba(255,255,255,0.3); padding-left:8px;"><span style="color:#ff8787">*</span> = Required to Close Day</span></span>
  </div>
  <div class="header-right">
    <div>
      <div class="date-main" id="todayDate"></div>
      <div id="dayStatus"></div>
    </div>
    <div class="header-btn-group">
      <button class="btn-header" onclick="goToReport()">üìä Reports</button>
      <button class="btn-header reset" onclick="resetToday()">üîÅ Reset</button>
    </div>
  </div>
</header>

<div id="main-wrapper">
  <div class="progress-widget">
    <div class="progress-header"><span>Overall Completion</span><span id="overallLabel">0%</span></div>
    <div class="progress-track"><div class="progress-fill" id="overallBar"></div></div>
  </div>

  <div class="partial-action-bar">
    <button id="partialBodBtn" class="btn-snapshot" onclick="takeBodSnapshot()">üì∏ Mark Partial BOD Done</button>
    <span id="partialStatus"></span>
  </div>

  <div id="container"></div>

  <div class="section">
    <div class="section-header"><h2>‚ûï Other Tasks (Ad-hoc)</h2></div>
    <div class="ad-hoc-box">
      <div class="form-group"><input type="text" id="customTaskName" class="form-control" placeholder="Task Title (e.g., Client Call)"></div>
      <div class="form-group"><textarea id="customTaskRemark" class="form-control" rows="2" placeholder="Outcome / Details"></textarea></div>
      <button id="addCustomBtn" class="btn btn-primary" onclick="addCustomTask()">Add Task to Today's Report</button>
    </div>
  </div>
</div>

<div class="final-action-area"><button id="closeBtn" class="final-btn" onclick="closeDay()">‚úÖ Close Operations Day</button></div>

<script src="js/data.js"></script>
<script>
/* ---------- KEYS & INIT ---------- */
const today = new Date().toISOString().split("T")[0];
const DAILY_KEY       = "daily_" + today;
const PARTIAL_BOD_KEY = "partialBOD_" + today;
const OTHER_TASK_KEY  = "otherTasks_" + today;
const CLOSE_KEY       = "dayClosed_" + today;

document.getElementById("todayDate").innerText = today;

/* ---------- CORE FUNCTIONS ---------- */
function updateDayStatus() {
  const closed = localStorage.getItem(CLOSE_KEY);
  const statusDiv = document.getElementById("dayStatus");
  const btn = document.getElementById("closeBtn");
  if (closed) {
    statusDiv.innerHTML = `<span style="color:#ff8787">üîí Closed at ${closed}</span>`;
    btn.innerText = "üîí Day Closed";
    btn.disabled = true;
    btn.classList.add("inactive");
  } else {
    statusDiv.innerHTML = `<span style="color:#4ade80">‚óè Live / Active</span>`;
  }
}

function updateOverallProgress(data) {
  const total = processes.length;
  const done = Object.keys(data).length;
  const percent = Math.round((done / total) * 100);
  document.getElementById("overallLabel").innerText = `${done}/${total} (${percent}%)`;
  document.getElementById("overallBar").style.width = percent + "%";
}

function takeBodSnapshot() {
  if (localStorage.getItem(PARTIAL_BOD_KEY)) return alert("‚ÑπÔ∏è Snapshot already taken.");
  const data = JSON.parse(localStorage.getItem(DAILY_KEY) || "{}");
  const bodTasks = processes.filter(p => p.category === "BOD");
  const completedNames = bodTasks.filter(p => data[p.id]).map(p => p.name);
  if (completedNames.length === 0) return alert("‚ö†Ô∏è Complete at least one BOD task first.");
  
  const snapshot = {
    time: new Date().toLocaleTimeString(),
    completed: completedNames,
    pending: bodTasks.filter(p => !data[p.id]).map(p => p.name)
  };
  localStorage.setItem(PARTIAL_BOD_KEY, JSON.stringify(snapshot));
  renderPartialStatus();
  alert("üì∏ Snapshot saved.");
}

function renderPartialStatus() {
  const el = document.getElementById("partialStatus");
  const btn = document.getElementById("partialBodBtn");
  const snap = JSON.parse(localStorage.getItem(PARTIAL_BOD_KEY));
  if (!snap) return (el.innerText = "No snapshot taken", el.style.color = "var(--text-muted)");
  el.innerHTML = `‚úÖ Snapshot at ${snap.time} | ${snap.completed.length} Done`;
  el.style.color = "var(--success)";
  if(btn) btn.disabled = true;
}

function addCustomTask() {
  const name = document.getElementById("customTaskName").value.trim();
  const remark = document.getElementById("customTaskRemark").value.trim();
  if (!name || !remark) return alert("All fields required.");
  const tasks = JSON.parse(localStorage.getItem(OTHER_TASK_KEY) || "[]");
  tasks.push({ title: name, remark: remark, time: new Date().toLocaleTimeString(), status: "DONE" });
  localStorage.setItem(OTHER_TASK_KEY, JSON.stringify(tasks));
  alert("‚úÖ Task added.");
  document.getElementById("customTaskName").value = "";
  document.getElementById("customTaskRemark").value = "";
}

function handleCheckClick(id, total) {
  let count = 0;
  let checkedIndices = [];
  for(let i=0; i<total; i++) {
    const chk = document.getElementById(`chk_${id}_${i}`);
    if(chk && chk.checked) { count++; checkedIndices.push(i); }
  }
  localStorage.setItem(`temp_chk_${today}_${id}`, JSON.stringify(checkedIndices));
  const progText = document.getElementById(`prog_${id}`);
  if(progText) progText.innerText = `‚úî ${count} / ${total} checks completed`;
  const statusBox = document.getElementById(`status_${id}`);
  if(count === total && statusBox && !statusBox.disabled) statusBox.value = "DONE";
}

function updateCloseButtonState(data) {
  if (localStorage.getItem(CLOSE_KEY)) return;
  const required = processes.filter(p => p.dayCloseRequired);
  const allDone = required.every(p => data[p.id]);
  const btn = document.getElementById("closeBtn");
  if (!allDone) { btn.classList.add("inactive"); btn.innerText = "‚è≥ Tasks Pending"; }
  else { btn.classList.remove("inactive"); btn.innerText = "‚úÖ Close Operations Day"; }
}

function render() {
  const data = JSON.parse(localStorage.getItem(DAILY_KEY) || "{}");
  updateOverallProgress(data);
  updateDayStatus();
  updateCloseButtonState(data);
  renderPartialStatus();
  const container = document.getElementById("container");
  container.innerHTML = "";

  ["BOD","CONTINUOUS","EOD"].forEach(cat => {
    const sectionProcs = processes.filter(p => p.category === cat);
    const doneCount = sectionProcs.filter(p => data[p.id]).length;
    const section = document.createElement("div");
    section.className = "section";
    section.innerHTML = `<div class="section-header"><h2>${cat} Operations</h2><span class="section-stats">${doneCount} / ${sectionProcs.length} Done</span></div>`;
    const gridDiv = document.createElement("div");
    gridDiv.className = "cards-grid";

    sectionProcs.forEach(p => {
      const saved = data[p.id];
      const statusClass = saved ? saved.status.toLowerCase() : "pending";
      const card = document.createElement("div");
      card.className = "process-card " + statusClass;
      const mandatoryMark = p.dayCloseRequired ? `<span style="color:var(--danger); margin-left:4px; font-weight:bold;">*</span>` : "";
      let savedIndices = !saved ? JSON.parse(localStorage.getItem(`temp_chk_${today}_${p.id}`) || "[]") : [];
      const checksHTML = p.checks.map((c, idx) => {
        const isChecked = saved ? true : savedIndices.includes(idx);
        return `<label class="check-item"><input type="checkbox" id="chk_${p.id}_${idx}" ${isChecked ? "checked" : ""} ${saved ? "disabled" : ""} onclick="handleCheckClick('${p.id}', ${p.checks.length})"><span>${c}</span></label>`;
      }).join("");
      const currentCount = saved ? p.checks.length : savedIndices.length;

      card.innerHTML = `
        <div class="card-header"><div><div class="card-title">${p.name} ${mandatoryMark}</div><div class="card-time">‚è∞ ${p.timeWindow}</div></div>${saved ? `<span class="status-badge badge-${statusClass}">‚úî ${saved.status}</span>` : ''}</div>
        <div class="card-body"><span class="check-progress-text" id="prog_${p.id}">‚úî ${currentCount} / ${p.checks.length} checks completed</span>${checksHTML}</div>
        <div class="card-footer">
          <div class="form-group"><select id="status_${p.id}" class="form-control" ${saved ? "disabled" : ""}><option value="">-- Status --</option><option value="DONE">Done</option><option value="PENDING">Pending</option><option value="ISSUE">Issue</option></select></div>
          <div class="form-group"><textarea id="remark_${p.id}" class="form-control" placeholder="Remarks..." ${saved ? "disabled" : ""}></textarea></div>
          <input type="file" id="file_${p.id}" ${saved ? "disabled" : ""} />
          <div class="submit-wrapper"><button class="btn ${saved ? "btn-disabled" : "btn-success"}" style="width:100%" ${saved ? "disabled" : ""} onclick="submitProcess('${p.id}', this)">${saved ? "Submitted" : "Submit Update"}</button></div>
        </div>`;
      if (saved) setTimeout(() => { document.getElementById(`status_${p.id}`).value = saved.status; document.getElementById(`remark_${p.id}`).value = saved.remark || ""; }, 0);
      gridDiv.appendChild(card);
    });
    section.appendChild(gridDiv);
    container.appendChild(section);
  });
}

function submitProcess(id, btn) {
  if(btn) { btn.disabled = true; btn.innerText = "Saving..."; }
  const p = processes.find(x => x.id === id);
  const status = document.getElementById("status_" + id).value;
  const remark = document.getElementById("remark_" + id).value.trim();
  const file = document.getElementById("file_" + id).files.length;
  const resetBtn = () => { if(btn) { btn.disabled = false; btn.innerText = "Submit Update"; } };

  if (!status) { alert("Select status."); resetBtn(); return; }
  if (status !== "DONE" && !remark) { alert("Remark required."); resetBtn(); return; }
  if (status === "ISSUE" && file === 0) { alert("Screenshot required."); resetBtn(); return; }

  let count = 0;
  for(let i=0; i<p.checks.length; i++) { if (document.getElementById(`chk_${id}_${i}`).checked) count++; }
  if (status === "DONE" && count < p.checks.length) { alert("Tick all checks."); resetBtn(); return; }

  localStorage.removeItem(`temp_chk_${today}_${id}`);
  const data = JSON.parse(localStorage.getItem(DAILY_KEY) || "{}");
  data[id] = { status, remark, submittedAt: new Date().toLocaleString() };
  localStorage.setItem(DAILY_KEY, JSON.stringify(data));
  location.reload();
}

function closeDay() {
  const btn = document.getElementById("closeBtn");
  if (btn.classList.contains("inactive")) return alert("‚ö†Ô∏è Tasks Pending! Complete all mandatory (*) tasks.");
  
  const data = JSON.parse(localStorage.getItem(DAILY_KEY) || "{}");
  const required = processes.filter(p => p.dayCloseRequired).map(p => p.id);
  if (!required.every(id => data[id])) return alert("‚ùå Mandatory data missing.");

  // INSTANT UX LOCK (Optional Suggestion Implemented)
  const snapBtn = document.getElementById("partialBodBtn");
  const addBtn = document.getElementById("addCustomBtn");
  if(snapBtn) snapBtn.disabled = true;
  if(addBtn) addBtn.disabled = true;

  localStorage.setItem(CLOSE_KEY, new Date().toLocaleTimeString());
  location.reload();
}

function resetToday() {
  if (!confirm("Reset all logs?")) return;
  localStorage.removeItem(DAILY_KEY); localStorage.removeItem(CLOSE_KEY);
  localStorage.removeItem(PARTIAL_BOD_KEY); localStorage.removeItem(OTHER_TASK_KEY);
  processes.forEach(p => localStorage.removeItem(`temp_chk_${today}_${p.id}`));
  location.reload();
}

function goToReport() { window.location.href = "history.html"; }

function init() {
  render();
  if (localStorage.getItem(CLOSE_KEY)) {
    const addBtn = document.getElementById("addCustomBtn");
    const snapBtn = document.getElementById("partialBodBtn");
    if(addBtn) addBtn.disabled = true;
    if(snapBtn) snapBtn.disabled = true;
  }
}
init();
</script></body></html>
